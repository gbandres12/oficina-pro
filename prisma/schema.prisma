generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Client {
  id        String         @id @default(cuid())
  name      String
  phone     String
  email     String?
  document  String?        @unique
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  orders    ServiceOrder[]
  vehicles  Vehicle[]
}

model Vehicle {
  id        String         @id @default(cuid())
  plate     String         @unique
  model     String
  brand     String
  clientId  String
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  vin       String?        @unique
  year      Int?
  orders    ServiceOrder[]
  client    Client         @relation(fields: [clientId], references: [id])
}

model ServiceOrder {
  id             String                 @id @default(cuid())
  number         Int                    @unique @default(autoincrement())
  status         OrderStatus            @default(OPEN)
  km             Int
  clientId       String
  vehicleId      String
  clientReport   String?
  signatureUrl   String?
  createdAt      DateTime               @default(now())
  entryDate      DateTime               @default(now())
  exitDate       DateTime?
  fuelLevel      Int?
  mechanic       String?

  observations   String?
  internalNotes  String?                // Notas internas apenas para ADMIN/MASTER
  updatedAt      DateTime               @updatedAt
  checklistItems ChecklistItem[]
  damagePoints   DamagePoint[]
  financials     FinancialTransaction[]
  parts          PartItem[]
  services       ServiceItem[]
  timeline       ServiceOrderTimeline[] // Relacionamento com timeline
  client         Client                 @relation(fields: [clientId], references: [id])
  vehicle        Vehicle                @relation(fields: [vehicleId], references: [id])
}

model ServiceOrderTimeline {
  id             String       @id @default(cuid())
  serviceOrderId String
  status         String
  description    String?
  userId         String?
  createdAt      DateTime     @default(now())
  serviceOrder   ServiceOrder @relation(fields: [serviceOrderId], references: [id])
}

model ChecklistItem {
  id             String       @id @default(cuid())
  name           String
  section        String
  status         String
  observation    String?
  photoUrl       String?
  serviceOrderId String
  serviceOrder   ServiceOrder @relation(fields: [serviceOrderId], references: [id])
}

model DamagePoint {
  id             String       @id @default(cuid())
  x              Float
  y              Float
  description    String?
  serviceOrderId String
  serviceOrder   ServiceOrder @relation(fields: [serviceOrderId], references: [id])
}

model ServiceItem {
  id             String       @id @default(cuid())
  description    String
  price          Decimal
  quantity       Decimal      @default(1)
  serviceOrderId String
  serviceOrder   ServiceOrder @relation(fields: [serviceOrderId], references: [id])
}

model PartItem {
  id             String       @id @default(cuid())
  name           String
  sku            String?
  price          Decimal
  quantity       Decimal
  serviceOrderId String
  serviceOrder   ServiceOrder @relation(fields: [serviceOrderId], references: [id])
}

model InventoryItem {
  id          String     @id @default(cuid())
  name        String
  sku         String     @unique
  quantity    Decimal
  minQuantity Decimal
  unitPrice   Decimal
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  sales       SaleItem[]
}

model CostCenter {
  id           String                 @id @default(cuid())
  name         String                 @unique
  description  String?
  createdAt    DateTime               @default(now())
  transactions FinancialTransaction[]
}

model FinancialTransaction {
  id             String            @id @default(cuid())
  type           TransactionType
  amount         Decimal
  description    String
  category       String?
  status         TransactionStatus @default(PAID)
  date           DateTime          @default(now())
  costCenterId   String?
  serviceOrderId String?
  createdAt      DateTime          @default(now())
  costCenter     CostCenter?       @relation(fields: [costCenterId], references: [id])
  serviceOrder   ServiceOrder?     @relation(fields: [serviceOrderId], references: [id])
}

model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String
  role      UserRole @default(EMPLOYEE)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  sales     Sale[]
}

model Sale {
  id            String     @id @default(cuid())
  number        Int        @unique @default(autoincrement())
  total         Decimal
  discount      Decimal    @default(0)
  paymentMethod String
  status        String     @default("COMPLETED")
  sellerId      String
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  seller        User       @relation(fields: [sellerId], references: [id])
  items         SaleItem[]
}

model SaleItem {
  id         String        @id @default(cuid())
  saleId     String
  productId  String
  quantity   Decimal
  unitPrice  Decimal
  totalPrice Decimal
  product    InventoryItem @relation(fields: [productId], references: [id])
  sale       Sale          @relation(fields: [saleId], references: [id])
}

enum OrderStatus {
  OPEN
  QUOTATION
  APPROVED
  IN_PROGRESS
  WAITING_PARTS
  FINISHED
  CANCELLED
}

enum TransactionType {
  INCOME
  EXPENSE
}

enum TransactionStatus {
  PENDING
  PAID
  CANCELLED
}

enum UserRole {
  ADMIN
  EMPLOYEE
}
